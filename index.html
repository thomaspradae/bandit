<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Máquina de Tres Brazos</title>
  <style>
    :root{
      --blue:#2563eb;
      --green:#16a34a;
      --slate:#1e293b;
      --bg:#f1f5f9;
      --rose:#f43f5e;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:system-ui,sans-serif;
      background:var(--bg);
      color:var(--slate);
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:1.8rem;
      padding:2rem;
    }
    h1{font-size:2.35rem;text-align:center;font-weight:700;line-height:1.2}
    .machines{display:flex;gap:1.5rem;flex-wrap:wrap;margin-top:.4rem}
    button.machine{
      position:relative;
      isolation:isolate;
      padding:1.25rem 2.4rem;
      font-size:1.35rem;
      font-weight:600;
      border:none;
      border-radius:1rem;
      background:#e5e7eb;
      color:var(--slate);
      box-shadow:0 6px 14px rgba(0,0,0,.12);
      cursor:pointer;
      transition:transform .12s,filter .12s;
    }
    button.machine:hover{filter:brightness(.92)}
    button.machine:active{transform:scale(.93)}
    button.machine:disabled{opacity:.4;cursor:not-allowed;filter:none}
    #status{font-size:1.15rem;min-height:1.6rem;text-align:center}
    #summary{font-size:1.5rem;font-weight:700;margin-top:1.4rem;text-align:center}
    table{margin-top:1.1rem;width:100%;max-width:480px;border-collapse:collapse;background:#fff;border-radius:.6rem;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.07)}
    th,td{padding:.55rem .7rem;text-align:center;border-bottom:1px solid #e2e8f0;font-size:.95rem}
    th{background:#e0e7ff;font-size:1rem;font-weight:600}
    tr.flash{animation:flashBg 1s ease-in-out}
    @keyframes flashBg{0%{background:#fef08a}100%{background:transparent}}
    #barWrap{position:relative;width:100%;max-width:480px;height:.65rem;background:#cbd5e1;border-radius:1rem;overflow:hidden;margin-top:-.6rem}
    #bar{position:absolute;inset:0;background:var(--green);transition:width .4s}
    .float{position:absolute;left:50%;top:0;transform:translate(-50%,0);font-size:1.1rem;font-weight:700;color:var(--green);pointer-events:none;animation:floatUp 1.4s forwards}
    @keyframes floatUp{0%{opacity:0;transform:translate(-50%,0) scale(.8)}20%{opacity:1;transform:translate(-50%,-10px) scale(1)}100%{opacity:0;transform:translate(-50%,-60px) scale(1.05)}}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .25s;z-index:60}
    .modal.show{opacity:1;pointer-events:auto}
    .modal-box{background:#fff;border-radius:1rem;padding:2rem 2.4rem;max-width:380px;width:90%;text-align:center;box-shadow:0 20px 44px rgba(0,0,0,.25);animation:pop .35s cubic-bezier(.21,1.02,.73,1.04)}
    @keyframes pop{0%{transform:scale(.7);opacity:0}100%{transform:scale(1);opacity:1}}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
</head>
<body>
  <h1>Máquina de Tres Brazos</h1>
  <div id="status"></div>
  <div class="machines">
    <button class="machine" data-id="A">Tirar A</button>
    <button class="machine" data-id="B">Tirar B</button>
    <button class="machine" data-id="C">Tirar C</button>
  </div>
  <div id="barWrap"><div id="bar"></div></div>
  <div id="summary"></div>
  <table id="log" hidden>
    <thead><tr><th>#</th><th>Máquina</th><th>Pago</th><th>Balance</th></tr></thead>
    <tbody></tbody>
  </table>
  <div id="modal" class="modal"><div class="modal-box" id="modalBox"></div></div>
<script>
function randn(m=0,s=1){let u=0,v=0;while(u===0)u=Math.random();while(v===0)v=Math.random();return m+s*Math.sqrt(-2*Math.log(u))*Math.cos(2*Math.PI*v)}
const params={A:{mean:2,std:1},B:{mean:5,std:8},C:{mean:3,std:1}};
const MAX_PULLS=15;
const STORAGE_KEY="bandit_done";
let pulls,bank,history,confettiShot;
const sEl=id=>document.getElementById(id);
const statusEl=sEl('status'),summaryEl=sEl('summary'),bar=sEl('bar');
const logTbl=sEl('log'),logBody=logTbl.querySelector('tbody');
const buttons=document.querySelectorAll('.machine');
const modal=sEl('modal'),modalBox=sEl('modalBox');
(function init(){if(localStorage.getItem(STORAGE_KEY)){const stored=JSON.parse(localStorage.getItem(STORAGE_KEY));pulls=0;bank=+stored.bank;history=stored.h;confettiShot=true;buttons.forEach(b=>b.disabled=true);render();endGame();}else resetState();})();
function resetState(){pulls=MAX_PULLS;bank=0;history=[];confettiShot=false;logBody.innerHTML='';summaryEl.textContent='';buttons.forEach(b=>b.disabled=false);modal.classList.remove('show');render();}
function render(){statusEl.textContent=`Tiros restantes: ${pulls}\u00A0—\u00A0Balance: $${bank.toFixed(2)}`;bar.style.width=`${(MAX_PULLS-pulls)/MAX_PULLS*100}%`;if(history.length){logTbl.hidden=false;renderRow();}}
function renderRow(){const r=history[history.length-1];const tr=document.createElement('tr');tr.className='flash';tr.innerHTML=`<td>${history.length}</td><td>${r.machine}</td><td>$${r.payout.toFixed(2)}</td><td>$${r.net.toFixed(2)}</td>`;logBody.appendChild(tr);} 
function pull(e){if(pulls===0)return;const id=e.currentTarget.dataset.id;const {mean,std}=params[id];const payout=Math.max(0,randn(mean,std));const cost=payout>0?1:0;bank+=payout-cost;pulls--;history.push({machine:id,payout,net:bank});floatLabel(e.currentTarget,`$${payout.toFixed(2)}`);render();if(pulls===0)endGame();}
function endGame(){summaryEl.textContent=`👏 BALANCE FINAL: $${bank.toFixed(2)}`;buttons.forEach(b=>b.disabled=true);storeResult();celebrate();}
function storeResult(){localStorage.setItem(STORAGE_KEY,JSON.stringify({bank:bank.toFixed(2),h:history}));}
function floatLabel(btn,txt){const span=document.createElement('span');span.className='float';span.textContent=txt;btn.appendChild(span);setTimeout(()=>span.remove(),1400);}
function celebrate(){if(confettiShot)return;confettiShot=true;const end=Date.now()+2500;(function frame(){confetti({particleCount:10,spread:70,colors:['#16a34a','#22c55e','#4ade80'],origin:{y:0.75}});if(Date.now()<end)requestAnimationFrame(frame);})();modalBox.innerHTML=`<h2 style='font-size:1.7rem;margin-bottom:.4rem'>Juego terminado</h2><p style='font-size:1.25rem;margin-bottom:.9rem'>Balance:<br><strong>$${bank.toFixed(2)}</strong></p><p style='font-size:.9rem;color:#64748b'>Un solo intento por navegador.</p>`;modal.classList.add('show');}
buttons.forEach(b=>b.addEventListener('click',pull));
</script>
</body>
</html>
